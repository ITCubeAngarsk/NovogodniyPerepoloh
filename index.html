<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ó–∏–º–Ω–∏–π –ü—Ä–æ–≥—Ä–∞–º–º–∏—Å—Ç—Å–∫–∏–π –ö–≤–µ—Å—Ç: –ì–ª–∞–≤–Ω–∞—è –ö–∞—Ä—Ç–∞</title>

    <link href="https://cdn.jsdelivr.net/gh/Alaev-Co/snowflakes/dist/snow.min.css" rel="stylesheet">
    
    <style>
        /* CSS –¥–ª—è –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã –∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã */
        body { 
            background-color: #0d1a26; 
            color: #ecf0f1; 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            text-align: center; 
            padding: 20px; 
            overflow-x: hidden; 
        }

        /* –û–±—â–∏–µ —Å—Ç–∏–ª–∏ */
        .quest-map { display: flex; justify-content: center; flex-wrap: wrap; gap: 25px; margin-top: 30px; max-width: 1200px; margin-left: auto; margin-right: auto; }
        h1 { color: #5dade2; text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5); }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —ç—Ç–∞–ø–æ–≤ */
        .stage {
            width: 220px; 
            min-height: 280px; 
            background-color: #1e3a52; 
            border-radius: 12px; 
            padding: 15px; 
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.5); 
            position: relative; 
            text-align: left; 
            font-size: 0.9em;
            border: 1px solid #3498db;
            
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        .stage h3 { margin-top: 0; color: #5dade2; font-size: 1.2em; border-bottom: 1px solid rgba(255, 255, 255, 0.1); padding-bottom: 5px; margin-bottom: 10px; }
        .description { font-size: 0.85em; margin-bottom: 15px; color: #bdc3c7; flex-grow: 1; }
        
        /* –ë–õ–û–ö–ò–†–û–í–ö–ê */
        .locked { filter: grayscale(100%) blur(1px); cursor: not-allowed; pointer-events: none; opacity: 0.6; }
        .locked::after { content: 'üîí'; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 3em; color: #bdc3c7; }
        
        /* –†–ê–ó–ë–õ–û–ö–ò–†–û–í–ö–ê –∏ –ü–†–û–ô–î–ï–ù–û */
        .unlocked { pointer-events: auto; filter: none; opacity: 1; }
        
        /* –°–¢–ò–õ–¨: –ó–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–π —ç—Ç–∞–ø */
        .completed { 
            background-color: #2ecc71; 
            border: 3px solid gold; 
            color: #ffffff; 
        }
        .completed h3 {
            color: #ffffff; 
            border-bottom: 1px solid rgba(255, 255, 255, 0.3); 
        }
        .completed .description {
            color: #e0e0e0; 
        }

        /* –°–¢–ò–õ–¨: –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∫–ª—é—á–∞ */
        .key-display {
            background-color: #1a6d3f; /* –¢–µ–º–Ω–æ-–∑–µ–ª–µ–Ω—ã–π —Ñ–æ–Ω –¥–ª—è –∫–æ–Ω—Ç—Ä–∞—Å—Ç–∞ */
            padding: 8px;
            border-radius: 6px;
            font-weight: bold;
            font-size: 1.1em;
            text-align: center;
            margin-bottom: 10px;
            word-wrap: break-word; 
        }

        /* –°–¢–ò–õ–¨: –ü–æ–¥—Å–∫–∞–∑–∫–∞ –æ —Å–¥–∞—á–µ */
        .submission-info {
            font-size: 0.9em;
            font-weight: bold;
            color: #ffdd77; /* –ñ–µ–ª—Ç—ã–π —Ü–≤–µ—Ç –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –≤–Ω–∏–º–∞–Ω–∏—è */
            text-align: center;
            margin-top: 10px;
        }
        
        /* --- –°–¢–ò–õ–ò –ö–ù–û–ü–û–ö --- */
        button { 
            width: 100%; 
            padding: 10px 15px; 
            margin-top: 10px; 
            cursor: pointer; 
            border: none; 
            border-radius: 8px; 
            color: white; 
            font-weight: bold;
            transition: background 0.3s, transform 0.1s;
        }
        button:hover { transform: translateY(-1px); }

        /* –ö–Ω–æ–ø–∫–∞ 1: –ù–ê–ß–ê–¢–¨ –ò–°–ü–´–¢–ê–ù–ò–ï (–ö—Ä—É–ø–Ω–∞—è, –æ—Å–Ω–æ–≤–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ) */
        .start-button { 
            background: #3498db; 
            font-size: 1em;
            margin-top: auto; 
        }
        .start-button:hover { background: #2980b9; }

        /* –ö–Ω–æ–ø–∫–∞ 2: –ü–†–û–í–ï–†–ò–¢–¨ –ö–õ–Æ–ß (–ü–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ) */
        .check-key-button { 
            background: #27ae60; 
            font-size: 0.9em;
        }
        .check-key-button:hover { background: #219d55; }
        
        /* –ö–Ω–æ–ø–∫–∞ —Å–º–µ–Ω—ã —É—Ä–æ–≤–Ω—è (–æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –∫–∞–∫ fixed) */
        #reset-button { background: #34495e; position: fixed; top: 10px; right: 10px; z-index: 100; width: auto; padding: 8px 12px; }
    </style>
</head>
<body>
    <button id="reset-button" style="display: none;" onclick="resetLevel()">üîÑ –°–º–µ–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å</button>

    <div id="start-screen">
        <h1>‚ùÑÔ∏è –ó–∏–º–Ω–∏–π –ö–≤–µ—Å—Ç: –í—ã–±–µ—Ä–∏—Ç–µ —Å–≤–æ–π –∫–ª–∞—Å—Å ‚ùÑÔ∏è</h1>
        <p>–í–∞—à –≤—ã–±–æ—Ä –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —Å–ª–æ–∂–Ω–æ—Å—Ç—å –∑–∞–¥–∞—á.</p>
        <button style="background: #2980b9;" onclick="selectLevel('junior')">1-4 –∫–ª–∞—Å—Å (–ú–ª–∞–¥—à–∏–π)</button>
        <button style="background: #2980b9;" onclick="selectLevel('middle')">5-8 –∫–ª–∞—Å—Å (–°—Ä–µ–¥–Ω–∏–π)</button>
        <button style="background: #2980b9;" onclick="selectLevel('senior')">9-11 –∫–ª–∞—Å—Å / –°–ü–û (–°—Ç–∞—Ä—à–∏–π)</button>
    </div>

    <div id="quest-hub" style="display: none;">
        <h1 id="quest-title"></h1>
        <p id="quest-subtitle"></p>
        <div class="quest-map" id="map-container">
            </div>
        <p style="margin-top: 30px;">
            <span id="score-legend"></span>
        </p>
    </div>
    
    <script src="https://cdn.jsdelivr.net/gh/Alaev-Co/snowflakes/dist/Snow.min.js"></script>
    <script>
        // --- –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø –ó–ê–î–ê–ß –ò –ö–õ–Æ–ß–ï–ô ---
        
        // –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è YANDEX_FORM_URL –±–æ–ª—å—à–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–Ω–æ–ø–æ–∫
        const YANDEX_FORM_URL = "–í–ê–®–ê_–°–°–´–õ–ö–ê_–ù–ê_–Ø–ù–î–ï–ö–°_–§–û–†–ú–£"; 
        
        // –ö–õ–Æ–ß–ò: –•—Ä–∞–Ω—è—Ç—Å—è –∫–∞–∫ –æ–±—ã—á–Ω—ã–µ —Å—Ç—Ä–æ–∫–∏ (–∫–∏—Ä–∏–ª–ª–∏—Ü–∞, –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä).
        const TASK_SETS = {
            junior: [ 
                { name: "–°–Ω–µ–∂–∏–Ω–∫–∞", key: '–Å–õ–ö–ê', challengeLink: 'challenges/j1.html', pointValue: 1, description: '–ù–∞–π–¥–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç–Ω–æ–µ —Å–ª–æ–≤–æ, —Å–ø—Ä—è—Ç–∞–Ω–Ω–æ–µ –≤ –∑–∏–º–Ω–µ–π –≥—Ä–∞—Ñ–∏–∫–µ.' }, 
                { name: "–û–ª–µ–Ω–∏", key: '–®–ï–°–¢–¨', challengeLink: 'challenges/j2.html', pointValue: 1, description: '–†–µ—à–∏—Ç–µ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫—É —Å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é —Å–∏–º–≤–æ–ª–æ–≤.' }, 
                { name: "–°–∞–Ω–∫–∏", key: '–°–ù–ï–ì', challengeLink: 'challenges/j3.html', pointValue: 1, description: '–ü—Ä–æ—Å—Ç–∞—è –∑–∞–¥–∞—á–∞ –Ω–∞ —Å–º–µ–∫–∞–ª–∫—É –∏ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å.' }, 
                { name: "–ü–æ–¥–∞—Ä–∫–∏", key: '–ß–ï–¢–´–†–ï', challengeLink: 'challenges/j4.html', pointValue: 1, description: '–í–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —É—Ç–µ—Ä—è–Ω–Ω–æ–µ —Å–ª–æ–≤–æ –ø–æ —á–∞—Å—Ç—è–º.' }, 
                { name: "–ï–ª–∫–∞", key: '50050', challengeLink: 'challenges/j5.html', pointValue: 1, description: '–í–∏–∑—É–∞–ª—å–Ω—ã–π –∫–≤–µ—Å—Ç: –Ω–∞–π–¥–∏—Ç–µ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω—É—é –ø–æ–¥—Å–∫–∞–∑–∫—É.' }, 
                { name: "–°–Ω–µ–≥–æ–≤–∏–∫", key: '–ü–†–ê–ó–î–ù–ò–ö', challengeLink: 'challenges/j6.html', pointValue: 1, description: '–§–∏–Ω–∞–ª—å–Ω—ã–π –∫–ª—é—á –∫–≤–µ—Å—Ç–∞. –ë—É–¥—å—Ç–µ –≤–Ω–∏–º–∞—Ç–µ–ª—å–Ω—ã!' }, 
            ],
            middle: [ 
                { name: "–®–∏—Ñ—Ä –¶–µ–∑–∞—Ä—è", key: '–ü–û–î–ê–†–ö–ò', challengeLink: 'challenges/m1.html', pointValue: 1, description: '–†–∞—Å—à–∏—Ñ—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ, –∏—Å–ø–æ–ª—å–∑—É—è –∫–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –º–µ—Ç–æ–¥.' }, 
                { name: "–ë–∏–Ω–∞—Ä–Ω–∞—è –µ–ª–∫–∞", key: '–ï–õ–ö–ê', challengeLink: 'challenges/m2.html', pointValue: 1, description: '–ü–µ—Ä–µ–≤–µ–¥–∏—Ç–µ –±–∏–Ω–∞—Ä–Ω—ã–π –∫–æ–¥ –≤ —Ç–µ–∫—Å—Ç.' }, 
                { name: "–ë–∞–∑–∞ –ø–æ–¥–∞—Ä–∫–æ–≤ (SQL)", key: '–°–ê–ù–ö–ò', challengeLink: 'challenges/m3.html', pointValue: 1, description: '–ù–∞–π–¥–∏—Ç–µ –∫–ª—é—á, –≤—ã–ø–æ–ª–Ω–∏–≤ SQL-–∑–∞–ø—Ä–æ—Å.' }, 
                { name: "–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞", key: '–ì–ò–†–õ–Ø–ù–î–ê', challengeLink: 'challenges/m4.html', pointValue: 1, description: '–†–∞—Å–ø–æ–ª–æ–∂–∏—Ç–µ —ç–ª–µ–º–µ–Ω—Ç—ã –≤ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ.' }, 
                { name: "–ü—É—Ç—å –°–∞–Ω—Ç—ã (JS Code)", key: '–°–ê–ù–ö–ò43', pointValue: 3, description: '–†–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –¥–ª—è —Ä–∞—Å—á–µ—Ç–∞ –æ–ø—Ç–∏–º–∞–ª—å–Ω–æ–≥–æ –º–∞—Ä—à—Ä—É—Ç–∞.' }, 
                { name: "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è (JS Code)", key: '–°–ù–û–í–´–ú–ì–û–î–û–ú', challengeLink: 'challenges/m6.html', pointValue: 3, description: '–ù–∞–ø–∏—à–∏—Ç–µ —Ñ—É–Ω–∫—Ü–∏—é –¥–ª—è —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ä–µ—Å—É—Ä—Å–∞–º–∏.' }, 
            ],
            senior: [ 
                { name: "–ö—Ä–∏–ø—Ç–æ–≥—Ä–∞—Ñ–∏—è", key: '–°–ù–ï–ñ–û–ö25', challengeLink: 'challenges/s1.html', pointValue: 1, description: '–î–µ–∫–æ–¥–∏—Ä—É–π—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–≥–æ —à–∏—Ñ—Ä–∞.' }, 
                { name: "JSON-API", key: '–û–õ–ï–ù–¨2', challengeLink: 'challenges/s2.html', pointValue: 1, description: '–ò–∑–≤–ª–µ–∫–∏—Ç–µ –∫–ª—é—á –∏–∑ —Å–ª–æ–∂–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö.' }, 
                { name: "–ê–ª–≥–æ—Ä–∏—Ç–º—ã", key: '–ó–í–ï–ó–î–ê72', challengeLink: 'challenges/s3.html', pointValue: 1, description: '–†–µ—à–∏—Ç–µ –≥–æ–ª–æ–≤–æ–ª–æ–º–∫—É, –∏—Å–ø–æ–ª—å–∑—É—è –ª–æ–≥–∏–∫—É –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è.' }, 
                { name: "–†–µ–≥—É–ª—è—Ä–∫–∏", key: '–°–û–°–£–õ–¨–ö–ê13', challengeLink: 'challenges/s4.html', pointValue: 1, description: '–ù–∞–π–¥–∏—Ç–µ –ø–∞—Ç—Ç–µ—Ä–Ω —Å—Ä–µ–¥–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–∞ —Å—Ç—Ä–æ–∫.' }, 
                { name: "–ì—Ä–∞—Ñ –ü–æ–¥–∞—Ä–∫–æ–≤ (Code)", key: '–ü–û–î–ê–†–û–ö72', challengeLink: 'challenges/s5.html', pointValue: 3, description: '–°–æ–∑–¥–∞–π—Ç–µ –∫–æ–¥ –¥–ª—è –Ω–∞—Ö–æ–∂–¥–µ–Ω–∏—è –∫—Ä–∞—Ç—á–∞–π—à–µ–≥–æ –ø—É—Ç–∏ –≤ –≥—Ä–∞—Ñ–µ.' }, 
                { name: "–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –õ–æ–≥–∏—Å—Ç–∏–∫–∏ (Code)", key: '–ó–ê–ú–û–ö18', challengeLink: 'challenges/s6.html', pointValue: 3, description: '–†–∞–∑—Ä–∞–±–æ—Ç–∞–π—Ç–µ –≤—ã—Å–æ–∫–æ–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∑–∞–¥–∞—á.' }, 
            ]
        };

        // --- –î–í–ò–ñ–û–ö –ö–í–ï–°–¢–ê ---
        
        let currentLevel = null;
        let currentTasks = [];
        let progressState = { maxCompleted: 0 };
        
        function selectLevel(level) {
            localStorage.setItem('userLevel', level);
            localStorage.removeItem('questProgress');
            updateMap(); 
        }

        function resetLevel() {
            if (confirm("–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å –∏ —Å–º–µ–Ω–∏—Ç—å —É—Ä–æ–≤–µ–Ω—å?")) {
                localStorage.removeItem('userLevel');
                localStorage.removeItem('questProgress');
                window.location.reload();
            }
        }

        function loadProgress() {
            currentLevel = localStorage.getItem('userLevel');
            const resetButton = document.getElementById('reset-button');
            
            if (!currentLevel || !TASK_SETS[currentLevel]) {
                document.getElementById('start-screen').style.display = 'block';
                document.getElementById('quest-hub').style.display = 'none';
                resetButton.style.display = 'none';
                return false;
            }

            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('quest-hub').style.display = 'block';
            resetButton.style.display = 'block';
            
            currentTasks = TASK_SETS[currentLevel];
            progressState = JSON.parse(localStorage.getItem('questProgress')) || { maxCompleted: 0 };
            
            const titleMap = { junior: '–ú–õ–ê–î–®–ò–ô (1-4 –∫–ª–∞—Å—Å)', middle: '–°–†–ï–î–ù–ò–ô (5-8 –∫–ª–∞—Å—Å)', senior: '–°–¢–ê–†–®–ò–ô (9-11/–°–ü–û)' };
            document.getElementById('quest-title').innerText = `üéÑ –ó–∏–º–Ω–∏–π –ö–≤–µ—Å—Ç: –£—Ä–æ–≤–µ–Ω—å ${titleMap[currentLevel]}`;
            document.getElementById('quest-subtitle').innerText = `–ü—Ä–æ–≥—Ä–µ—Å—Å: ${progressState.maxCompleted} –∏–∑ ${currentTasks.length} —ç—Ç–∞–ø–æ–≤ –∑–∞–≤–µ—Ä—à–µ–Ω–æ.`;

            const totalScore = currentLevel === 'junior' ? '6 –±–∞–ª–ª–æ–≤' : '10 –±–∞–ª–ª–æ–≤';
            document.getElementById('score-legend').innerHTML = `
                –ú–∞–∫—Å. –±–∞–ª–ª–æ–≤: <b>${totalScore}</b>. 
                <span style="color: #f7a822;">
                    ${currentLevel === 'junior' 
                        ? '–ö–∞–∂–¥—ã–π —ç—Ç–∞–ø = 1 –±–∞–ª–ª.' 
                        : '–≠—Ç–∞–ø—ã 1-4 = 1 –±–∞–ª–ª (–∫–ª—é—á). –≠—Ç–∞–ø—ã 5-6 = 3 –±–∞–ª–ª–∞ (–∫–ª—é—á + –∫–æ–¥).'}
                </span>
            `;

            return true;
        }

        // –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –≤–≤–æ–¥–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        function normalizeKey(key) {
            // –£–¥–∞–ª—è–µ–º –ø—Ä–æ–±–µ–ª—ã, –ø–µ—Ä–µ–≤–æ–¥–∏–º –≤ –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
            let normalized = key.trim().toUpperCase().replace(/\s/g, '');
            
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞: –∑–∞–º–µ–Ω—è–µ–º –Å –Ω–∞ –ï –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è –≤–≤–æ–¥–∞
            normalized = normalized.replace(/–Å/g, '–ï'); 
            
            return normalized;
        }

        function checkKey(stageNum, expectedKey) {
            const stageDiv = document.getElementById(`stage-${stageNum}`);
            const inputField = stageDiv.querySelector('input[type="text"]');
            
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –≤–≤–µ–¥–µ–Ω–Ω—ã–π –∫–ª—é—á (—É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã, –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä, –Å->–ï)
            const userInput = normalizeKey(inputField.value); 
            
            // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —ç—Ç–∞–ª–æ–Ω–Ω—ã–π –∫–ª—é—á (—É–±–∏—Ä–∞–µ–º –ø—Ä–æ–±–µ–ª—ã, –≤–µ—Ä—Ö–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä, –Å->–ï)
            const expectedNormalized = normalizeKey(expectedKey); 
            
            if (userInput === expectedNormalized) {
                alert('–ö–ª—é—á –≤–µ—Ä–Ω—ã–π! –≠—Ç–∞–ø –ø—Ä–æ–π–¥–µ–Ω. –¢–µ–ø–µ—Ä—å –≤–Ω–µ—Å–∏—Ç–µ –∫–ª—é—á –∏ –∫–æ–¥ (–µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è) –≤ –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º—É.');
                
                if (stageNum > progressState.maxCompleted) {
                    progressState.maxCompleted = stageNum;
                }
                localStorage.setItem('questProgress', JSON.stringify(progressState));
                
                updateMap(); 

            } else {
                alert('–ö–ª—é—á –Ω–µ –ø–æ–¥—Ö–æ–¥–∏—Ç. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –≤–≤–æ–¥–∞.');
            }
        }
        
        function updateMap() {
            if (!loadProgress()) return;

            const mapContainer = document.getElementById('map-container');
            mapContainer.innerHTML = ''; 
            
            currentTasks.forEach((task, index) => {
                const stageNum = index + 1;
                const isCompleted = stageNum <= progressState.maxCompleted;
                const isUnlocked = stageNum <= progressState.maxCompleted + 1; 
                const pointValue = task.pointValue; 
                
                const stageDiv = document.createElement('div');
                stageDiv.id = `stage-${stageNum}`;
                stageDiv.classList.add('stage');
                
                if (isCompleted) {
                    stageDiv.classList.add('completed');
                } else if (!isUnlocked) {
                    stageDiv.classList.add('locked');
                } else {
                    stageDiv.classList.add('unlocked');
                }

                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–µ–∫—Å—Ç –¥–ª—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ —Å–¥–∞—á–µ
                const submissionInfoText = (pointValue === 3) 
                    ? '–°–¥–∞–π—Ç–µ —ç—Ç–æ—Ç –∫–ª—é—á –∏ –∫–æ–¥, –∫–æ—Ç–æ—Ä—ã–π –≤—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª–∏, –≤ –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º—É.' 
                    : '–°–¥–∞–π—Ç–µ —ç—Ç–æ—Ç –∫–ª—é—á –≤ –Ø–Ω–¥–µ–∫—Å.–§–æ—Ä–º—É.';

                const scoreText = (pointValue === 3) 
                    ? '<span style="color:#FFD700;">–ö–ª—é—á (1 –±–∞–ª–ª) + –ö–æ–¥ (2 –±–∞–ª–ª–∞)</span>' 
                    : `–ö–ª—é—á: ${pointValue} –±–∞–ª–ª`;

                stageDiv.innerHTML = `
                    <div class="top-content">
                        <h3>–≠—Ç–∞–ø ${stageNum}: ${task.name}</h3>
                        <p class="description">${task.description}</p>
                        <p style="font-size:0.8em; margin-bottom: 10px;">–û—Ü–µ–Ω–∫–∞: ${scoreText}</p>
                    </div>

                    <div class="bottom-controls">
                        <a href="${task.challengeLink}" target="_blank">
                            <button class="start-button">
                                ${isCompleted ? '–ò—Å–ø—ã—Ç–∞–Ω–∏–µ –ü—Ä–æ–π–¥–µ–Ω–æ' : '–ù–ê–ß–ê–¢–¨ –ò–°–ü–´–¢–ê–ù–ò–ï'}
                            </button>
                        </a>
                    
                        ${!isCompleted && isUnlocked ? `
                            <div class="key-input-box" style="margin-top: 15px;">
                                <input type="text" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á">
                                <button class="check-key-button" onclick="checkKey(${stageNum}, '${task.key}')">–ü–†–û–í–ï–†–ò–¢–¨ –ö–õ–Æ–ß</button>
                            </div>
                        ` : ''}

                        ${isCompleted ? `
                            <div id="submission-link-${stageNum}" style="margin-top: 15px;">
                                <div class="key-display">
                                    üîë –í–ê–® –ö–õ–Æ–ß: <b>${task.key}</b>
                                </div>
                                <div class="submission-info">
                                    ${submissionInfoText}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
                mapContainer.appendChild(stageDiv);
            });
            
            if (progressState.maxCompleted === currentTasks.length) {
                document.getElementById('quest-subtitle').innerText = `–ü–û–ó–î–†–ê–í–õ–Ø–ï–ú! –ö–≤–µ—Å—Ç –∑–∞–≤–µ—Ä—à–µ–Ω! üéâ`;
            }
        }

        // –ó–∞–ø—É—Å–∫ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ –∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Ä—Ç—ã –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        window.onload = function() {
            new Snow (); 
            updateMap();
        };
    </script>
</body>
</html>